/*
 * AIW full screen preview modal
 *
 * This stylesheet introduces a refreshed dark design for the full screen
 * preview modal used by the AI Wallpaper Builder. It co‑exists with
 * the existing AWB modal markup and only targets elements created for
 * the new layout via the `.aiw-` class prefix. Core functionality
 * (progress overlay, revision area, action buttons) remains intact
 * through the reuse of existing class names such as `.awb-preview-images`,
 * `.progress-overlay`, `.awb-modal-revision`, `.revise-text`, `.awb-apply`
 * and `.awb-revise`.
 */

/* Hide the legacy modal structure when the AIW modal is present. The
   `class-awb-frontend.php` template no longer emits `.awb-inner` and
   related elements, but this rule is kept defensively to ensure
   older markup doesn’t show up if injected by a third party. */
.awb-modal .awb-inner {
  display: none;
}

/* Wrapper for the new dialog. It fills the viewport and provides
   a light backdrop. */
#awb-modal {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(255, 255, 255, 0.95);
  z-index: 9999;
  display: none; /* shown via JS */
}

/* WordPress Admin Bar Support - Only when user is logged in */
.logged-in #awb-modal {
  top: 32px; /* WordPress admin bar height */
  height: calc(100vh - 32px);
}

/* For mobile WordPress admin bar */
@media screen and (max-width: 782px) {
  .logged-in #awb-modal {
    top: 46px; /* Mobile admin bar height */
    height: calc(100vh - 46px);
  }
}

/* The main dialog container that holds the header, body and sidebar. */
.aiw-modal__dialog {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #ffffff;
  color: #333333;
  display: flex;
  flex-direction: column;
  border-radius: 0;
  overflow: hidden;
}

/* Header with tabs, lane selector and close icon. */
.aiw-modal__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  background: #000000; /* Black as requested */
  border-bottom: none;
  color: #ffffff;
  height: 64px; /* Material standard */
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  position: relative;
  z-index: 100;
}

/* Left side - Title */
.aiw-tabs {
  display: flex;
  align-items: center;
  gap: 16px;
  font-size: 20px;
  font-weight: 500;
}

/* Center - Controls */
.aiw-controls {
  display: flex;
  align-items: center;
  gap: 16px;
}
.aiw-tab {
  padding: 8px 12px;
  border-radius: 0;
  border: 1px solid #555555;
  background: #333333;
  color: #ffffff;
  cursor: pointer;
  font-size: 14px;
}
.aiw-tab.is-active {
  border-color: #00a3ff;
  box-shadow: 0 0 0 2px rgba(0, 163, 255, 0.15) inset;
}

/* Lane selector group */
.aiw-controls {
  /* Allow lane selector to occupy the free space between the tabs and the close button */
  flex: 1;
  display: flex;
  justify-content: center;
}
.aiw-select {
  display: flex;
  align-items: center;
  gap: 8px;
}
.aiw-select__label {
  color: #ffffff;
  font-size: 15px;
}
.aiw-select select {
  background: #333333;
  border: 1px solid #555555;
  border-radius: 0;
  color: #ffffff;
  padding: 6px 8px;
}

/* Close button */
.aiw-close {
  border: none;
  background: transparent;
  color: #ffffff;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
  font-weight: normal;
}
.aiw-close:hover {
  background-color: rgba(255,255,255,0.1);
}

/* Layout for body: preview on the left and sidebar on the right. */
.aiw-modal__body {
  flex: 1;
  display: grid;
  /* Use a 3:1 ratio for preview to sidebar (approx. 75%/25%) */
  grid-template-columns: 3fr 1fr;
  gap: 16px;
  padding: 16px;
  height: calc(100% - 54px);
}
@media (max-width: 1100px) {
  .aiw-modal__body {
    grid-template-columns: 1fr;
  }
}

/* Preview container */
.aiw-preview {
  position: relative;
  display: flex;
  flex-direction: column;
  min-height: 0;
}
.aiw-preview__stage {
  position: relative;
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  /* White background for the preview area */
  background: #ffffff;
  border: 1px solid #ddd;
  border-radius: 0;
  overflow: hidden;
  /* Make preview wider by reducing horizontal margins */
  margin: 0 5px; /* Reduced from default margins */
}
/* Support responsive aspect ratio via data-aspect attribute */
.aiw-preview__stage[data-aspect] {
  aspect-ratio: attr(data-aspect number);
}
.awb-preview-images {
  position: absolute;
  top: 32px; /* Start below ruler */
  left: 0;
  right: 0;
  bottom: 0;
}

.awb-preview-images img {
  width: 100%;
  height: auto;
  object-fit: contain;
  display: block;
}

/* Lanes overlay: draws vertical stripes over the preview */
.aiw-preview__lanes {
  pointer-events: none;
  position: absolute;
  top: 32px; /* Start below ruler */
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: stretch;
  gap: 0;
  /* Make lanes visible on a light background */
  opacity: 1;
  mix-blend-mode: normal;
  z-index: 15;
}

/* Each lane will be created dynamically via JS, but here we specify
   the base appearance. */
.aiw-preview__lanes .aiw-lane {
  /* Subtle stripes for white preview area */
  border-right: 1px solid rgba(0,0,0,0.1);
  background: rgba(0,0,0,0.02);
}
.aiw-preview__lanes .aiw-lane.last {
  border-right: 2px dashed rgba(0, 0, 0, 0.3);
}

/* Crop overlay for user image upload and OpenAI results. The overlay shades
   the areas outside the target aspect ratio and allows horizontal dragging.
   The frame represents the visible portion of the mural. */
.aiw-crop-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 5; /* above lanes */
}
.aiw-crop-left,
.aiw-crop-right {
  position: absolute;
  top: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.6);
  pointer-events: none;
}
.aiw-crop-frame {
  position: absolute;
  top: 0;
  bottom: 0;
  border: 2px solid rgba(0, 0, 0, 0.5);
  box-sizing: border-box;
  cursor: ew-resize;
  pointer-events: all;
}

/* Progress overlay reused from the existing modal. The `.visible` class is
   toggled in JS to display the overlay. */
.progress-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: row;
  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  font-size: 24px;
  z-index: 10;
}
.progress-overlay.visible {
  display: flex;
}

/* Sidebar with fields */
.aiw-sidebar {
  background: #ffffff;
  border: 1px solid #ddd;
  border-radius: 0;
  padding: 14px;
  overflow: auto;
  display: flex;
  flex-direction: column;
  color: #333;
}
.aiw-field {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 12px;
}
.aiw-field label {
  font-size: 15px;
  color: #333;
}
.aiw-field input[type="text"],
.aiw-field input[type="number"],
.aiw-field select,
.aiw-field textarea {
  background: #ffffff;
  border: 1px solid #ccc;
  border-radius: 0;
  color: #111;
  padding: 8px 10px;
  outline: none;
  box-sizing: border-box;
}
.aiw-field input:focus,
.aiw-field select:focus,
.aiw-field textarea:focus {
  border-color: #00a3ff;
  box-shadow: 0 0 0 2px rgba(0, 163, 255, 0.15);
}

/* Style for size inputs inside sidebar (awb-input-group) */
.aiw-sidebar .size-inputs {
  display: flex;
  gap: 10px;
  align-items: center;
}
.aiw-sidebar .awb-input-group {
  position: relative;
  flex: 1 1 0;
  min-width: 0;
}
.aiw-sidebar .awb-input-group input[type=number] {
  width: 100%;
  padding: 8px 36px 8px 36px;
  border: 1px solid #ccc;
  border-radius: 0;
  font-size: 15px;
  line-height: 1.2;
  box-sizing: border-box;
  color: #111;
  background: #fff;
}
.aiw-sidebar .awb-input-group .icon {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 18px;
  opacity: 0.7;
  pointer-events: none;
}
.aiw-sidebar .awb-input-group .unit {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  color: #777;
  font-weight: 600;
  font-size: 14px;
  pointer-events: none;
}
.aiw-sidebar .size-sep {
  font-size: 18px;
  color: #6b6b6b;
  margin: 0 2px;
}

/* Style cards in sidebar: lighten background and border */
.aiw-sidebar .card {
  background: #f8f8f8;
  border-color: #ddd;
}
.aiw-sidebar .card.selected {
  border-color: #00a3ff;
}
.aiw-sidebar .card img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 0;
}
.aiw-size-grid {
  display: grid;
  gap: 6px;
}
.aiw-size-row {
  display: grid;
  grid-template-columns: 20px 1fr 28px;
  align-items: center;
  gap: 8px;
}
.aiw-size-icon {
  opacity: 0.8;
}
.aiw-size-row .unit {
  opacity: 0.6;
}

/* Cards (style options) reuse existing AWB styling for card selection. */
.aiw-field .cards {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.aiw-field .card {
  position: relative;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  border: 2px solid transparent;
  border-radius: 0;
  padding: 4px;
  cursor: pointer;
  transition: transform 0.2s ease;
  overflow: visible;
}
.aiw-field .card input[type="radio"] {
  display: none;
}
.aiw-field .card img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 0;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.aiw-field .card:hover img {
  transform: scale(2.5);
  z-index: 3;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.aiw-field .card.selected {
  border-color: #00a3ff;
}
.aiw-field .card.selected img {
  box-shadow: 0 0 0 2px #00a3ff, 0 4px 12px rgba(0,0,0,0.3);
}

/* Buttons for apply and revise actions */
.aiw-buttons {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}
.aiw-buttons .button {
  padding: 10px 12px;
  border-radius: 0;
  border: 1px solid #2a2f38;
  background: #ffffff;
  color: #e8eaed;
  cursor: pointer;
}
.aiw-buttons .button.button-primary {
  border-color: #00a3ff;
  background: #0a6fb1;
}
.aiw-buttons .button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Hide the built‑in AWB tab controls when using the AIW modal */
.aiw-preview__stage .awb-tabs {
  display: none !important;
}

/*
 * Cropping overlay
 *
 * The cropping wrapper is absolutely positioned within the preview stage and
 * ensures that the image covers the full height of the stage while allowing
 * horizontal dragging. When the wrapper has the .dragging class the cursor
 * changes to indicate movement. The inner image scales its width according
 * to its natural aspect ratio relative to the stage height.
 */
.aiw-crop-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  cursor: grab;
  user-select: none;
}
.aiw-crop-wrapper.dragging {
  cursor: grabbing;
}
.aiw-crop-image {
  position: relative;
  height: 100%;
  width: auto;
  top: 0;
  left: 0;
}

/* Fixed Bottom Right Action Buttons */
.awb-fixed-bottom-right {
  position: fixed !important;
  bottom: 24px !important;
  right: 24px !important;
  z-index: 10000 !important;
  display: flex !important;
  flex-direction: row !important;
  gap: 12px !important;
  pointer-events: auto !important;
}

.awb-fixed-bottom-right .button {
  min-width: 160px !important;
  padding: 12px 20px !important;
  font-size: 14px !important;
  font-weight: 500 !important;
  border-radius: 4px !important;
  border: none !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
  font-family: 'Roboto', sans-serif !important;
  text-transform: uppercase !important;
  letter-spacing: 0.5px !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.12), 0 1px 3px rgba(0,0,0,0.24) !important;
}

.awb-fixed-bottom-right .button:hover {
  transform: translateY(-1px) !important;
  box-shadow: 0 4px 8px rgba(0,0,0,0.16), 0 2px 6px rgba(0,0,0,0.28) !important;
}

.awb-fixed-bottom-right .button-primary {
  background: #4CAF50 !important;
  color: white !important;
}

.awb-fixed-bottom-right .button-primary:hover {
  background: #45A049 !important;
}

.awb-fixed-bottom-right .awb-revise {
  background: #000000 !important;
  color: white !important;
}

.awb-fixed-bottom-right .awb-revise:hover {
  background: #333333 !important;
}

/* Hide original button containers when fixed positioning is active */
.awb-modal-actions.awb-fixed-bottom-right ~ .awb-modal-actions:not(.awb-fixed-bottom-right) {
  display: none !important;
}

/* Material UI style buttons */
.awb-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 120px;
  height: 36px;
  padding: 8px 16px;
  margin: 0 4px;
  border: none;
  border-radius: 4px;
  font-family: "Roboto", sans-serif;
  font-size: 14px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  text-decoration: none;
  outline: none;
}

.awb-btn:hover {
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  transform: translateY(-1px);
}

.awb-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.awb-btn-primary {
  background: #2196F3;
  color: white;
}

.awb-btn-primary:hover {
  background: #1976D2;
  color: white;
}

.awb-btn-secondary {
  background: #424242;
  color: white;
}

.awb-btn-secondary:hover {
  background: #303030;
  color: white;
}

/* Fixed bottom right positioning */
.awb-modal-actions.awb-fixed-bottom-right {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  display: flex;
  flex-direction: row;
  gap: 8px;
}
